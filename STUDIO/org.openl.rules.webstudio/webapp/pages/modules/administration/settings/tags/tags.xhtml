<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:a4j="http://richfaces.org/a4j">

    <style>
        #tagTemplateForm\:tagTemplates {
            height: 60px;
        }
    </style>
    <h:panelGroup>
        <h:form>
            <h1>Tag types</h1>
            <h:dataTable id="tagTypeList" value="#{tagTypeBean.tagTypes}" var="tagType" styleClass="table">
                <h:column>
                    <f:facet name="header">
                        Name
                    </f:facet>
                    <span class="clickable" onclick="editTagType(#{tagType.id})" title="Edit">
                        <h:outputText value="#{tagType.name}"/>
                    </span>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        Extensible
                    </f:facet>
                    #{tagType.extensible ? 'Yes' : 'No'}
                </h:column>
                <h:column>
                    <f:facet name="header">
                        Nullable
                    </f:facet>
                    #{tagType.nullable ? 'Yes' : 'No'}
                </h:column>
                <h:column>
                    <f:facet name="header">Action</f:facet>
                    <a4j:commandLink execute="@this" render="@form tagsSection"
                                     action="#{tagTypeBean.delete(tagType.name)}"
                                     styleClass="delete-icon"
                                     onclick="if(!window.confirm('Are you sure you want to delete the tag type?')) {return false;}"
                                     title="Delete"/>
                </h:column>
            </h:dataTable>

            <a href="javascript:void(0)" onclick="editTagType()">Add New Tag Type</a>
        </h:form>

        <ui:include src="/pages/modules/administration/settings/tags/editTagType.xhtml"/>
        <ui:include src="/pages/modules/administration/settings/tags/projectsWithoutTags.xhtml"/>
    </h:panelGroup>

    <h:panelGroup id="tagsSection">
        <h:form rendered="#{not empty tagTypeBean.tagTypes}">
            <h1>Tags</h1>
            <h:dataTable id="tagList" value="#{tagBean.tags}" var="tag" styleClass="table">
                <h:column>
                    <f:facet name="header">
                        Tag type
                    </f:facet>
                    <span class="clickable" onclick="editTag(#{tag.id})" title="Edit">
                        <h:outputText value="#{tag.type.name}"/>
                    </span>
                </h:column>
                <h:column>
                    <f:facet name="header">
                        Name
                    </f:facet>
                    <span class="clickable" onclick="editTag(#{tag.id})" title="Edit">
                        <h:outputText value="#{tag.name}"/>
                    </span>
                </h:column>
                <h:column>
                    <f:facet name="header">Action</f:facet>
                    <a4j:commandLink execute="@this" render="@form"
                                     action="#{tagBean.delete(tag.id)}"
                                     onclick="if(!window.confirm('Are you sure you want to delete the tag?')) {return false;}"
                                     styleClass="delete-icon"
                                     title="Delete"/>
                </h:column>
            </h:dataTable>

            <a href="javascript:void(0)" onclick="editTag()">Add New Tag</a>
        </h:form>

        <ui:include src="/pages/modules/administration/settings/tags/editTag.xhtml"/>
    </h:panelGroup>

    <h:panelGroup>
        <h:form id="tagTemplateForm">
            <h1>Tags from project name</h1>
            <div>
                <p>Project name template is used to extract tags from project name.</p>
                <p>Tag types are wrapped with '%' symbol. '?' means any symbol. '*' means any text with any length.</p>
                <p>For example, if we have template <strong>%Domain%-%LOB%-*</strong>, then for
                    project <strong>Policy-L&amp;A-rules</strong> tags will be <strong>Policy</strong> for tag
                    type <strong>Domain</strong> and <strong>L&amp;A</strong> for <strong>LOB</strong>.</p>
                <p>Each template should be in a new line.</p>
                <p>The order of templates is important: first template has higher priority, last template has lowest priority.</p>
            </div>
            <table>
                <tr>
                    <td>Project name templates:</td>
                    <td>
                        <h:inputTextarea id="tagTemplates"
                                         value="#{tagTemplateBean.templates}"
                                         validator="#{tagTemplateBean.templateValidator}"/>

                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td><a4j:outputPanel ajaxRendered="true">
                        <h:message for="tagTemplates" styleClass="error"/>
                    </a4j:outputPanel></td>
                </tr>
            </table>
            <a4j:commandButton value="Save" action="#{tagTemplateBean.save}"
                             render="commonProps repositoryProps javaProps restartMessage tags"
                             styleClass="button-primary" title="Apply changes"/>
            <input type="button" value="Fill tags for projects" onclick="openProjectsWithoutTags()"/>

        </h:form>
    </h:panelGroup>

</ui:composition>
