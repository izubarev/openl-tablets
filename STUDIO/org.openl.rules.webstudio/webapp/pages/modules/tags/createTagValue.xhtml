<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:a4j="http://richfaces.org/a4j"
        xmlns:rich="http://richfaces.org/rich">

    <rich:popupPanel id="modalCreateTagValue" minWidth="330" autosized="true">
        <f:facet name="header">
            <h:outputText value="Create Tag"/>
        </f:facet>

        <f:facet name="controls">
            <h:graphicImage value="/images/close.gif" class="close"
                            onclick="hideCreateTagValue()" alt="Close"/>
        </f:facet>

        <h:form id="createTagValueForm">
            <div>
                <table class="formfields">
                    <tr>
                        <td class="label">
                            <label>Tag type:</label>
                        </td>
                        <td>
                            <span><h:outputText value="#{projectTagsBean.tagTypeForNewTag}"/></span>
                        </td>
                    </tr>
                    <tr>
                        <td class="label">
                            <label class="required">Tag:</label>
                        </td>
                        <td>
                            <h:inputText value="#{projectTagsBean.newTagValue}"/>
                        </td>
                    </tr>
                </table>
            </div>

            <footer>
                <a4j:commandButton value="Create" data="#{facesContext.maximumSeverity}"
                                   action="#{projectTagsBean.saveTag}"
                                   oncomplete="if(!event.data) {hideCreateTagValue(); funcAfterCreate();}"
                                   styleClass="button-primary"/>
                <input type="button" value="Cancel" onclick="hideCreateTagValue()"/>
            </footer>

            <a4j:jsFunction name="initCreateTagValueDialog" render="@form" oncomplete="showCreateTagValueDialog();">
                <a4j:param name="tagType" assignTo="#{projectTagsBean.tagTypeForNewTag}"/>
            </a4j:jsFunction>

        </h:form>

    </rich:popupPanel>

    <script>
        //<![CDATA[
        let tagTypeForForm = '';
        let funcAfterCreate = function () {};

        function createTagValue(tagType, onCreate) {
            tagTypeForForm = tagType;
            funcAfterCreate = onCreate;
            initCreateTagValueDialog(tagType);
        }

        function showCreateTagValueDialog() {
            RichFaces.$('modalCreateTagValue').show();
        }

        function hideCreateTagValue() {
            RichFaces.$("modalCreateTagValue").hide();
        }

        //]]>
    </script>

</ui:composition>
